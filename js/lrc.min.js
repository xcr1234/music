/*Audio音乐歌词滚动显示 Javascript插件 v16.0709
https://git.coding.net/xcr_abcd/music.git*/
;(function(h,j){var d=function(n){return new d.fn.init(n)};d.fn=d.prototype={init:function(n){this.dom=n},css:function(n){var o=this.dom;if(!(typeof h.getComputedStyle=="undefined")){return h.getComputedStyle(o,null)[n]}else{return o.currentStyle[n]}},data:function(o,p){var q=this.dom;if(q.dataset){if(p==undefined){return q.dataset[o]}else{return q.dataset[o]=p}}else{var n="data-"+o;if(p==undefined){return q.getAttribute(n)}else{return q.setAttribute(n,p)}}},extend:function(o,n){for(name in n){o[name]=n[name]}return o}};d.fn.init.prototype=d.fn;d.extend=d.fn.extend;d.get=function(p,q,s){if(typeof s!="undefined"&&typeof s!="function"){throw new TypeError(s+" is not a function")}var n=h.XMLHttpRequest?new h.XMLHttpRequest():new ActiveXObject("Microsoft.XMLHTTP");var o=p;if(typeof q!="undefined"){var r=c(q);o=o+"?"+r}n.open("GET",o,true);n.onreadystatechange=function(){if(n.readyState==4){var t=n.status;if(t>=200&&t<300){s(n.responseText,t,n)}}};n.send()};var e=h.jQuery?h.jQuery:d;if(h.jQuery){e.fn.extend({loadLrc:function(n){return h.loadLrc(this[0],n)},activeAudio:function(n){return h.activeAudio(this[0],n)},lrc:function(q,o){var p=h.loadLrc(this[0],q);var n=e(o);h.activeAudio(n[0],p)}})}var g=h.lrcCtrl={};var m={active:function(n){n.style.fontWeight="700"},normal:function(n){n.style.fontWeight="normal"},fix:28,initMargin:80,offset:0};g.active=function(n){n.style.fontWeight="700"};g.normal=function(n){n.style.fontWeight="normal"};e.lrcCtrl=h.lrcCtrl;var f=h.lrcFix=28;function b(o,n){this.audio=o;this.lrc=n.dom.getElementsByTagName("p");this.dom=n.dom;this.current=0;this.currentTime=0;this.options=e.extend(m,g);if(n.offset!=undefined){this.options.offset=n.offset}if(n.fix!=undefined){this.options.fix=n.fix}this.lrcobj=n}b.prototype.active=function(n){if(typeof this.lrcobj.active=="function"){this.lrcobj.active(n)}else{if(typeof g.active=="function"){g.active(n)}}};b.prototype.normal=function(n){if(typeof this.lrcobj.normal=="function"){this.lrcobj.normal(n)}else{if(typeof g.normal=="function"){g.normal(n)}}};b.prototype.timeChanged=function(o){if(this.current==this.lrc.length){return}var n=parseFloat(e(this.lrc[this.current]).data("time"))+this.options.offset;if(l(o,n)){this.moveNext();this.current++}};b.prototype.moveNext=function(){var n=parseInt(e(this.dom).css("marginTop"));if(this.current>0){this.normal(this.lrc[this.current-1])}this.active(this.lrc[this.current]);this.dom.style.marginTop=(n-this.options.fix)+"px"};b.prototype.toggle=function(q){var p=-1;for(var n=this.lrc.length-1;n>=0;n--){var r=parseFloat(e(this.lrc[n]).data("time"))+this.options.offset;if(p<0&&l(q,r)){p=n}this.normal(this.lrc[n])}if(p<this.lrc.length&&p>0){var o=this.options.initMargin-this.options.fix*p;this.dom.style.marginTop=o+"px";this.current=p}};function c(p){var n=[];for(var o in p){n.push(encodeURIComponent(o)+"="+encodeURIComponent(p[o]))}n.push(("v="+Math.random()).replace(".",""));return n.join("&")}if(!Array.prototype.forEach){Array.prototype.forEach=function(t,o){var q,p=0;
if(this==null){throw new TypeError(" this is null or not defined")}var s=Object(this);var n=s.length>>>0;if(typeof t!=="function"){throw new TypeError(t+" is not a function")}if(arguments.length>1){q=o}while(p<n){var r;if(p in s){r=s[p];t.call(q,r,p,s)}p++}}}function i(q){var o=q.split("\n"),p=/\[\d{2}:\d{2}.\d{2}\]/g,n=[];while(!p.test(o[0])){o=o.slice(1)}o[o.length-1].length===0&&o.pop();o.forEach(function(s,t,r){var w=s.match(p),u=s.replace(p,"");if(w!=null){w.forEach(function(z,y,v){var x=z.slice(1,-1).split(":");n.push([parseInt(x[0],10)*60+parseFloat(x[1]),u])})}});n.sort(function(s,r){return s[0]-r[0]});return n}function l(o,n){return o>n||Math.abs(o-n)<=0.5}var k=h.loadLrc=function(o,n){this.dom=o;e.get(n,undefined,function(u){var q=i(u);for(var s=0;s<q.length;s++){var r=q[s];var t=j.createElement("p");e(t).data("time",r[0]);t.innerHTML=r[1];t.style.overflow="hidden";o.appendChild(t)}});return this};var a=h.activeAudio=function(p,o){var n=new b(p,o);p.addEventListener("timeupdate",function(){n.timeChanged(this.currentTime)});p.addEventListener("seeked",function(){n.toggle(this.currentTime)})}})(window,window.document);