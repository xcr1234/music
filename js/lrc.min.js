/*Audio音乐歌词滚动显示 Javascript插件 v16.0722
https://git.coding.net/xcr_abcd/music.git*/
!function(a,b){function h(a,b){this.audio=a,this.lrc=b.dom.getElementsByTagName("p"),this.dom=b.dom,this.current=0,this.currentTime=0,this.options=d.extend(f,e),void 0!=b.offset&&(this.options.offset=b.offset),void 0!=b.fix&&(this.options.fix=b.fix),this.lrcobj=b}function i(a){var c,b=[];for(c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.push(("v="+Math.random()).replace(".","")),b.join("&")}function j(a){for(var b=a.split("\n"),c=/\[\d{2}:\d{2}.\d{2}\]/g,d=[];!c.test(b[0]);)b=b.slice(1);return 0===b[b.length-1].length&&b.pop(),b.forEach(function(a){var f=a.match(c),g=a.replace(c,"");null!=f&&f.forEach(function(a){var e=a.slice(1,-1).split(":");d.push([60*parseInt(e[0],10)+parseFloat(e[1]),g])})}),d.sort(function(a,b){return a[0]-b[0]}),d}function k(a,b){return a>b||Math.abs(a-b)<=.5}function l(a,b,c){this.dom=a,"function"==typeof b&&a.addEventListener("timeupdate",function(){b(this.currentTime)}),"function"==typeof c&&a.addEventListener("seeked",function(){c(this.currentTime)})}function m(b,c,d){if("object"!=typeof a.audiojs&&"object"!=typeof a.audiojs.events)throw new ReferenceError("audiojs is not correctly defined!");audiojs.events.ready(function(){var a=audiojs.create(b,{updatePlayhead:function(b){"function"==typeof c&&c(a.duration*b)},skipTo:function(b){"function"==typeof d&&d(a.duration*b)}})})}var d,e,f,c=function(a){return new c.fn.init(a)};c.fn=c.prototype={init:function(a){this.dom=a},css:function(b){var c=this.dom;return"undefined"!=typeof a.getComputedStyle?a.getComputedStyle(c,null)[b]:c.currentStyle[b]},data:function(a,b){var d,c=this.dom;return c.dataset?void 0==b?c.dataset[a]:c.dataset[a]=b:(d="data-"+a,void 0==b?c.getAttribute(d):c.setAttribute(d,b))},extend:function(a,b){for(name in b)a[name]=b[name];return a}},c.fn.init.prototype=c.fn,c.extend=c.fn.extend,c.get=function(b,c,d){var e,f,g;if("undefined"!=typeof d&&"function"!=typeof d)throw new TypeError(d+" is not a function");e=a.XMLHttpRequest?new a.XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),f=b,"undefined"!=typeof c&&(g=i(c),f=f+"?"+g),e.open("GET",f,!0),e.onreadystatechange=function(){if(4==e.readyState){var a=e.status;a>=200&&300>a&&d(e.responseText,a,e)}},e.send()},d=a.jQuery?a.jQuery:c,a.jQuery&&d.fn.extend({loadLrc:function(b){return a.loadLrc(this[0],b)},activeAudio:function(b){return a.activeAudio(this[0],b)},lrc:function(b,c){var e=a.loadLrc(this[0],b),f=d(c);a.activeAudio(f[0],e)}}),e=a.lrcCtrl={},f={active:function(a){a.style.fontWeight="700"},normal:function(a){a.style.fontWeight="normal"},fix:28,initMargin:80,offset:0},e.active=function(a){a.style.fontWeight="700"},e.normal=function(a){a.style.fontWeight="normal"},d.lrcCtrl=a.lrcCtrl,a.lrcFix=28,h.prototype.active=function(a){"function"==typeof this.lrcobj.active?this.lrcobj.active(a):"function"==typeof e.active&&e.active(a)},h.prototype.normal=function(a){"function"==typeof this.lrcobj.normal?this.lrcobj.normal(a):"function"==typeof e.normal&&e.normal(a)},h.prototype.timeChanged=function(a){if(this.current!=this.lrc.length){var b=parseFloat(d(this.lrc[this.current]).data("time"))+this.options.offset;k(a,b)&&(this.moveNext(),this.current++)}},h.prototype.moveNext=function(){var a=parseInt(d(this.dom).css("marginTop"));this.current>0&&this.normal(this.lrc[this.current-1]),this.active(this.lrc[this.current]),this.dom.style.marginTop=a-this.options.fix+"px"},h.prototype.toggle=function(a){var c,e,f,b=-1;for(c=this.lrc.length-1;c>=0;c--)e=parseFloat(d(this.lrc[c]).data("time"))+this.options.offset,0>b&&k(a,e)&&(b=c),this.normal(this.lrc[c]);b<this.lrc.length&&b>0&&(f=this.options.initMargin-this.options.fix*b,this.dom.style.marginTop=f+"px",this.current=b)},Array.prototype.forEach||(Array.prototype.forEach=function(a,b){var c,e,f,g,d=0;if(null==this)throw new TypeError(" this is null or not defined");if(e=Object(this),f=e.length>>>0,"function"!=typeof a)throw new TypeError(a+" is not a function");for(arguments.length>1&&(c=b);f>d;)d in e&&(g=e[d],a.call(c,g,d,e)),d++}),a.loadLrc=function(a,c){return this.dom=a,d.get(c,void 0,function(c){var f,g,h,e=j(c);for(f=0;f<e.length;f++)g=e[f],h=b.createElement("p"),d(h).data("time",g[0]),h.innerHTML=g[1],h.style.overflow="hidden",a.appendChild(h)}),this},a.activeAudio=function(b,c){var d=new h(b,c),e=void 0;e=a.Audio?l:m,e(b,function(a){d.timeChanged(a)},function(a){d.toggle(a)})}}(window,window.document);